# Frontend Conventions (React Native / Expo)

## Folder Structure

```
arena-app/
├── app/                    # Expo Router — routing ONLY, no logic
├── screens/                # Screen implementations — actual UI logic
│   ├── chat-tab/           # Level 1: externally importable
│   │   └── controls/       # Internal to this screen only
│   ├── chat/
│   └── friend-tab/
├── components/             # Cross-screen shared UI only
├── api/
│   ├── api-client.ts       # Axios instance + auth interceptor
│   ├── swagger.json        # Cached Swagger spec
│   └── generated/          # Orval auto-generated API client
│       └── models/         # Server DTO types
├── offline/
│   └── db/
│       ├── schema/         # Table names, columns, row types, parse helpers
│       ├── queries/        # CRUD functions importing from schema
│       └── migrations/     # Immutable, sequential (XXX_description.ts)
└── stores/                 # Zustand stores (cross-screen state)
```

## Component Pattern

One component per file:
```typescript
export default function ChatTabScreen() {
  // ...
}
```

No `index.ts` re-exports.

## State Management

1. Start with `useState` for local state
2. Zustand for cross-screen state sharing
3. React Query for server state (API calls)

## API Client

- Auto-generated by Orval from backend Swagger spec
- Server DTO types from `api/generated/models/` — use these directly
- Only create separate UI models when DB joins require it
- Regenerate: `npm run orval`

## DB Layer (Offline)

### Schema files (`offline/db/schema/`)
```typescript
export const tableName = 'users';
export const cols = { userId: 'user_id', data: 'data' };
export type UserRow = { userId: string; data: string };
```

### Query files (`offline/db/queries/`)
```typescript
export const usersQuery = {
  findById: async (params: { userId: string }, db?: SQLiteDatabase) => { ... }
};
```

- First arg: params object
- Second arg: optional `db` for transactions
- `upsertMany` self-wraps in transaction only when no external `db` is passed

### Migrations (`offline/db/migrations/`)
- Sequential numbering: `001_create_users.ts`, `002_add_channels.ts`
- Immutable once deployed — never edit existing migrations

## Path Alias

`@/` maps to project root (configured in tsconfig).

```typescript
import { ChatScreen } from '@/screens/chat/ChatScreen';
```

## Auth

- Supabase (Google + Kakao social login)
- Token injected via Axios interceptor in `api/api-client.ts`
- Token stored securely on device
